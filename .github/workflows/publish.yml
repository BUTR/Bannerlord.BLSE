name: Publish

on:
  push:
    branches:
      - master
    paths:
      - '.github/workflows/publish.yml'
      - 'src/Bannerlord.BLSE/**.*'
      - 'src/Bannerlord.LauncherEx/**.*'
      - 'src/Bannerlord.BLSE.Shared/**.*'
      - 'src/Bannerlord.BLSE.Standalone/**.*'
      - 'src/Bannerlord.BLSE.Launcher/**.*'
      - 'src/Bannerlord.BLSE.LauncherEx/**.*'
  workflow_dispatch:

env:
  # Disable the .NET logo in the console output.
  DOTNET_NOLOGO: true
  # Disable the .NET first time experience to skip caching NuGet packages and speed up the build.
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
  # Disable sending .NET CLI telemetry to Microsoft.
  DOTNET_CLI_TELEMETRY_OPTOUT: true

jobs:
  publish:
    name: Publish NuGet
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Build Bannerlord.BLSE
        run: >-
          mkdir bannerlord;
          dotnet build src/Bannerlord.BLSE.Shared/Bannerlord.BLSE.Shared.csproj --configuration Release -p:GameFolder="$PWD/bannerlord";
          dotnet build src/Bannerlord.BLSE.Standalone/Bannerlord.BLSE.Standalone.csproj --configuration Release -p:GameFolder="$PWD/bannerlord";
          dotnet build src/Bannerlord.BLSE.Launcher/Bannerlord.BLSE.Launcher.csproj --configuration Release -p:GameFolder="$PWD/bannerlord";
          dotnet build src/Bannerlord.BLSE.LauncherEx/Bannerlord.BLSE.LauncherEx.csproj --configuration Release -p:GameFolder="$PWD/bannerlord";
        shell: pwsh
        
      - name: Upload Bannerlord folder
        uses: actions/upload-artifact@v3
        with:
          name: bannerlord
          path: ./bannerlord/